<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="è´ªåƒè›‡å¤§ä½œæˆ˜ - å†å²è®°å½•ä¸æ’è¡Œæ¦œ">
    <title>è´ªåƒè›‡å¤§ä½œæˆ˜ - å†å²è®°å½•</title>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <!-- åŠ¨æ€èƒŒæ™¯çƒä½“ -->
    <div class="background-orbs">
        <div class="orb orb-cyan"></div>
        <div class="orb orb-fuchsia"></div>
    </div>

    <!-- ä¸»å®¹å™¨ -->
    <div class="main-container">
        <!-- æ ‡é¢˜ -->
        <h1 class="gradient-title gradient-title-sm">ğŸ“Š æ¸¸æˆè®°å½•</h1>
        <p class="subtitle">æŸ¥çœ‹æ’è¡Œæ¦œå’Œä½ çš„å†å²æˆç»©</p>

        <!-- æ ‡ç­¾åˆ‡æ¢ -->
        <div class="glass-card" style="width: 100%; max-width: 500px;">
            <div class="tabs">
                <button class="tab active" id="tab-leaderboard" onclick="switchTab('leaderboard')">ğŸ† æ’è¡Œæ¦œ</button>
                <button class="tab" id="tab-history" onclick="switchTab('history')">ğŸ“œ æˆ‘çš„è®°å½•</button>
            </div>

            <!-- æ’è¡Œæ¦œ -->
            <div id="leaderboard-container" class="leaderboard">
                <ul class="leaderboard-list" id="leaderboard-list">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </ul>
                <p id="leaderboard-empty" class="text-center hidden" style="color: var(--text-muted); padding: 40px 0;">
                    æš‚æ— è®°å½•ï¼Œå¿«å»ç©æ¸¸æˆå§ï¼
                </p>
            </div>

            <!-- æˆ‘çš„è®°å½• -->
            <div id="history-container" class="leaderboard hidden">
                <ul class="leaderboard-list" id="history-list">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </ul>
                <p id="history-empty" class="text-center hidden" style="color: var(--text-muted); padding: 40px 0;">
                    ä½ è¿˜æ²¡æœ‰æ¸¸æˆè®°å½•
                </p>
            </div>
        </div>

        <!-- è¿”å›æŒ‰é’® -->
        <div class="game-controls">
            <button class="btn btn-primary" onclick="window.location.href='game.html'">
                â† è¿”å›æ¸¸æˆ
            </button>
        </div>
    </div>

    <script src="js/storage.js"></script>
    <script src="js/auth.js"></script>
    <script>
        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        if (!Auth.requireLogin()) {
            // å¦‚æœæœªç™»å½•ï¼ŒrequireLogin ä¼šè‡ªåŠ¨è·³è½¬
        }

        /**
         * åˆ‡æ¢æ ‡ç­¾
         */
        function switchTab(tab) {
            const leaderboardContainer = document.getElementById('leaderboard-container');
            const historyContainer = document.getElementById('history-container');
            const tabLeaderboard = document.getElementById('tab-leaderboard');
            const tabHistory = document.getElementById('tab-history');

            if (tab === 'leaderboard') {
                leaderboardContainer.classList.remove('hidden');
                historyContainer.classList.add('hidden');
                tabLeaderboard.classList.add('active');
                tabHistory.classList.remove('active');
            } else {
                leaderboardContainer.classList.add('hidden');
                historyContainer.classList.remove('hidden');
                tabLeaderboard.classList.remove('active');
                tabHistory.classList.add('active');
            }
        }

        /**
         * è·å–æ’åæ ·å¼ç±»å
         */
        function getRankClass(rank) {
            if (rank === 1) return 'gold';
            if (rank === 2) return 'silver';
            if (rank === 3) return 'bronze';
            return '';
        }

        /**
         * æ ¼å¼åŒ–æ—¥æœŸ
         */
        function formatDate(isoString) {
            const date = new Date(isoString);
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            return `${month}-${day} ${hours}:${minutes}`;
        }

        /**
         * æ¸²æŸ“æ’è¡Œæ¦œ
         */
        function renderLeaderboard() {
            const leaderboard = Storage.getLeaderboard(10);
            const listElement = document.getElementById('leaderboard-list');
            const emptyElement = document.getElementById('leaderboard-empty');

            if (leaderboard.length === 0) {
                listElement.innerHTML = '';
                emptyElement.classList.remove('hidden');
                return;
            }

            emptyElement.classList.add('hidden');

            listElement.innerHTML = leaderboard.map((record, index) => {
                const rank = index + 1;
                const rankClass = getRankClass(rank);
                return `
          <li class="leaderboard-item">
            <span class="leaderboard-rank ${rankClass}">#${rank}</span>
            <span class="leaderboard-name">${record.username}</span>
            <span class="leaderboard-score">${record.score} åˆ†</span>
          </li>
        `;
            }).join('');
        }

        /**
         * æ¸²æŸ“æˆ‘çš„è®°å½•
         */
        function renderHistory() {
            const username = Auth.getCurrentUsername();
            const records = Storage.getUserRecords(username);
            const listElement = document.getElementById('history-list');
            const emptyElement = document.getElementById('history-empty');

            if (records.length === 0) {
                listElement.innerHTML = '';
                emptyElement.classList.remove('hidden');
                return;
            }

            emptyElement.classList.add('hidden');

            listElement.innerHTML = records.slice(0, 20).map((record, index) => {
                return `
          <li class="leaderboard-item">
            <span class="leaderboard-time">${formatDate(record.playedAt)}</span>
            <span class="leaderboard-name" style="margin-left: auto;">æ—¶é•¿ ${record.duration}ç§’</span>
            <span class="leaderboard-score">${record.score} åˆ†</span>
          </li>
        `;
            }).join('');
        }

        // é¡µé¢åŠ è½½æ—¶æ¸²æŸ“æ•°æ®
        document.addEventListener('DOMContentLoaded', () => {
            renderLeaderboard();
            renderHistory();
        });
    </script>
</body>

</html>
