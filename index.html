<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="è´ªåƒè›‡å¤§ä½œæˆ˜ - ä¸€æ¬¾ç²¾ç¾çš„ç½‘é¡µç‰ˆè´ªåƒè›‡æ¸¸æˆ">
  <title>è´ªåƒè›‡å¤§ä½œæˆ˜ - ç™»å½•</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <!-- åŠ¨æ€èƒŒæ™¯çƒä½“ -->
  <div class="background-orbs">
    <div class="orb orb-cyan"></div>
    <div class="orb orb-fuchsia"></div>
  </div>

  <!-- ä¸»å®¹å™¨ -->
  <div class="main-container">
    <!-- æ ‡é¢˜ -->
    <h1 class="gradient-title">ğŸ è´ªåƒè›‡å¤§ä½œæˆ˜</h1>
    <p class="subtitle">ç»å…¸æ¸¸æˆï¼Œå…¨æ–°ä½“éªŒ</p>

    <!-- ç™»å½•/æ³¨å†Œå¡ç‰‡ -->
    <div class="glass-card" style="width: 100%; max-width: 400px;">
      <!-- æ ‡ç­¾åˆ‡æ¢ -->
      <div class="tabs">
        <button class="tab active" id="tab-login" onclick="switchTab('login')">ç™»å½•</button>
        <button class="tab" id="tab-register" onclick="switchTab('register')">æ³¨å†Œ</button>
      </div>

      <!-- æ¶ˆæ¯æç¤ºåŒº -->
      <div id="message-container"></div>

      <!-- ç™»å½•è¡¨å• -->
      <form id="login-form" onsubmit="handleLogin(event)">
        <div class="form-group">
          <label class="form-label" for="login-username">ç”¨æˆ·å</label>
          <input type="text" id="login-username" class="form-input" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" autocomplete="username">
        </div>
        <div class="form-group">
          <label class="form-label" for="login-password">å¯†ç </label>
          <input type="password" id="login-password" class="form-input" placeholder="è¯·è¾“å…¥å¯†ç " autocomplete="current-password">
        </div>
        <button type="submit" class="btn btn-primary btn-block">
          ğŸš€ ç™»å½•
        </button>
      </form>

      <!-- æ³¨å†Œè¡¨å• -->
      <form id="register-form" class="hidden" onsubmit="handleRegister(event)">
        <div class="form-group">
          <label class="form-label" for="register-username">ç”¨æˆ·å</label>
          <input type="text" id="register-username" class="form-input" placeholder="2-20ä¸ªå­—ç¬¦" autocomplete="username">
        </div>
        <div class="form-group">
          <label class="form-label" for="register-password">å¯†ç </label>
          <input type="password" id="register-password" class="form-input" placeholder="è‡³å°‘4ä¸ªå­—ç¬¦" autocomplete="new-password">
        </div>
        <div class="form-group">
          <label class="form-label" for="register-confirm">ç¡®è®¤å¯†ç </label>
          <input type="password" id="register-confirm" class="form-input" placeholder="å†æ¬¡è¾“å…¥å¯†ç " autocomplete="new-password">
        </div>
        <button type="submit" class="btn btn-primary btn-block">
          âœ¨ æ³¨å†Œ
        </button>
      </form>
    </div>
  </div>

  <script src="js/storage.js"></script>
  <script src="js/auth.js"></script>
  <script>
    // æ£€æŸ¥æ˜¯å¦å·²ç™»å½•ï¼Œå¦‚æœå·²ç™»å½•åˆ™è·³è½¬åˆ°æ¸¸æˆé¡µ
    if (Auth.isLoggedIn()) {
      window.location.href = 'game.html';
    }

    /**
     * åˆ‡æ¢ç™»å½•/æ³¨å†Œæ ‡ç­¾
     */
    function switchTab(tab) {
      const loginForm = document.getElementById('login-form');
      const registerForm = document.getElementById('register-form');
      const tabLogin = document.getElementById('tab-login');
      const tabRegister = document.getElementById('tab-register');
      const messageContainer = document.getElementById('message-container');

      // æ¸…é™¤æ¶ˆæ¯
      messageContainer.innerHTML = '';

      if (tab === 'login') {
        loginForm.classList.remove('hidden');
        registerForm.classList.add('hidden');
        tabLogin.classList.add('active');
        tabRegister.classList.remove('active');
      } else {
        loginForm.classList.add('hidden');
        registerForm.classList.remove('hidden');
        tabLogin.classList.remove('active');
        tabRegister.classList.add('active');
      }
    }

    /**
     * æ˜¾ç¤ºæ¶ˆæ¯
     */
    function showMessage(message, type = 'error') {
      const container = document.getElementById('message-container');
      container.innerHTML = `<div class="message message-${type}">${message}</div>`;
    }

    /**
     * å¤„ç†ç™»å½•
     */
    function handleLogin(event) {
      event.preventDefault();
      
      const username = document.getElementById('login-username').value;
      const password = document.getElementById('login-password').value;

      const result = Auth.login(username, password);
      
      if (result.success) {
        showMessage(result.message, 'success');
        setTimeout(() => {
          window.location.href = 'game.html';
        }, 500);
      } else {
        showMessage(result.message, 'error');
      }
    }

    /**
     * å¤„ç†æ³¨å†Œ
     */
    function handleRegister(event) {
      event.preventDefault();
      
      const username = document.getElementById('register-username').value;
      const password = document.getElementById('register-password').value;
      const confirm = document.getElementById('register-confirm').value;

      // éªŒè¯å¯†ç ç¡®è®¤
      if (password !== confirm) {
        showMessage('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´', 'error');
        return;
      }

      const result = Auth.register(username, password);
      
      if (result.success) {
        showMessage(result.message, 'success');
        setTimeout(() => {
          window.location.href = 'game.html';
        }, 500);
      } else {
        showMessage(result.message, 'error');
      }
    }
  </script>
</body>
</html>
